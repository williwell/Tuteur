<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="../CSS/UserProfile.css"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script src="../JS/Script.js"></script>
        <meta charset="utf-8" />
        <meta name="author" content="Alexandra Sirois, William-Arthur Cinq-Mars, Mathieu Harvey">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Accueil</title>
    </head>

<body>
    <div id="MenuBar"></div>

        <div class="multi-button" style="margin-top:4%">
            <button onclick="goToAjoutInfo()">Matière des cours</button>
            <button onclick="loadStudent()">Profiles des élèves</button>
            <button  onclick="logOut()">Me déconnecter</button>
        </div>

        <div class="container-fluid">

            <div id='ajoutCours' class='row' style="margin-top: 5%;">
              
            </div>

            <div id="demandeTutorat" class="row justify-content-evenly" style="margin:1%;margin-top:5%;display: flex;align-content: center;text-align: center;justify-content: center;">
                    <div  class="col-8 justify-content-evenly" style="align-content: center;text-align: center;justify-content: center;">
                        <div id="tableHeaderDemande" class="table justify-content-evenly" style="align-content: center;text-align: center;justify-content: center;">
                        
                        </div>
                        <div id="TableDemande" class="table-content justify-content-evenly"  style="align-content: center;text-align: center;justify-content: center;">
                        
                        </div>
                    </div>
            </div>
        </div>
     
</body>



    <script type="text/javascript">
        jQuery('#MenuBar').load('Menu.html#Menu'); 
        var matricule = getCookie("MatriculeLogged");
        var isTutor = getCookie("isTutor");


        function logOut(){
            document.cookie = "MatriculeLogged=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            document.cookie = "isLogged=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            document.cookie = "isTutor=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            location.replace("Login.html");
        }

        function goToAjoutInfo(){
            location.replace("AjoutMatiere.html");
        }

        function loadStudent(){
            $("#ajoutCours").empty();
            $.ajax({
                url: "../PHP/GetAllTutor.php",
                type: "POST",
                dataType: "json",
                success: function(result){
                    putStudentTutor(result);
                },
                error: function (message, er) {
                    console.log("erreur lors du chargement du profil des etudiants:" + er);
                }
            });

        }

        function putStudentTutor(result){
            $("#TableDemande").empty();
            $("#tableHeaderDemande").empty();
                $("#tableHeaderDemande").append(
                "<div class='table-header'>"+
                    "<div class='header__item'><a id='name' class='filter__link' href='#'>Matricule</a></div>"+
                    "<div class='header__item'><a id='name' class='filter__link' href='#'>Nom de l'élève</a></div>"+
                    "<div class='header__item'><a id='name' class='filter__link' href='#'>Type d'étudiant</a></div>"+
                    "<div class='header__item'><a id='name' class='filter__link' href='#'>Supprimer le profil</a></div>"+
                    "<div class='header__item'><a id='name' class='filter__link' href='#'>Ajouter des cours enseignés</a></div>"+
                "</div>");

            for (var i = 0; i < result.length; i++) {
                $("#TableDemande").append(
                "<div class='table-row'>"+
                    "<div  style='cursor: default;' class='table-data'>"+result[i][0]+"</div>"+
                    "<div  style='cursor: default;' class='table-data'>"+result[i][5]+" "+result[i][1]+"</div>"+
                    "<div style='cursor: default;' class='table-data'>Tuteur</div>"+
                    "<div style='cursor: pointer;' class='table-data' onclick='supprimerTuteur("+result[i][0]+")'><p id='btnEffacer' class='horizontal' style='font-size:10px'><span class='text'>Supprimer</span></p></div>"+
                    "<div style='cursor: pointer;' class='table-data' onclick='ajouterCoursEleve("+result[i][0]+")'><p id='btnEffacer' class='horizontal' style='font-size:10px'><span class='text'>Cours enseignés</span></p></div>"+
                "</div>");
            }
            $.ajax({
                url: "../PHP/GetAllAider.php",
                type: "POST",
                dataType: "json",
                success: function(result){
                    putStudentAider(result);
                },
                error: function (message, er) {
                    console.log("erreur lors du chargement du profil des etudiants:" + er);
                }
            });
        }


        
        function putStudentAider(result){
                $("#tableHeaderDemande").append();

                for (var i = 0; i < result.length; i++) {
                $("#TableDemande").append(
                "<div class='table-row'>"+
                    "<div  style='cursor: default;' class='table-data'>"+result[i][0]+"</div>"+
                    "<div  style='cursor: default;' class='table-data'>"+result[i][5]+" "+result[i][1]+"</div>"+
                    "<div style='cursor: default;' class='table-data'>Aider</div>"+
                    "<div style='cursor: pointer;' class='table-data' onclick='supprimerAider("+result[i][0]+")'><p id='btnEffacer' class='horizontal' style='font-size:10px'><span class='text'>Supprimer</span></p></div>"+
                    "<div style='cursor: pointer;' class='table-data'></div>"+
                "</div>");
            }
        }


        function supprimerTuteur(matricule){
            var typeStudent = 1;
            $.ajax({
                url: "../PHP/DeleteStudent.php",
                type: "POST",
                dataType: "json",
                data: {
                    "matricule": matricule,
                    "isTuteur": typeStudent
                },
                success: function(result){
                   location.reload();
                },
                error: function (message, er) {
                    console.log("erreur lors du chargement du profil des etudiants:" + er);
                }
            });
        }

        function supprimerAider(matricule){
            var typeStudent = 2;
            $.ajax({
                url: "../PHP/DeleteStudent.php",
                type: "POST",
                dataType: "json",
                data: {
                    "matricule": matricule,
                    "isTuteur": typeStudent
                },
                success: function(result){
                   location.reload();
                },
                error: function (message, er) {
                    console.log("erreur lors du chargement du profil des etudiants:" + er);
                }
            });
        }

        function ajouterCoursEleve(matricule){
            $("#ajoutCours").empty();
            $("#ajoutCours").append(
                "<div class='col'>"+
                "<div class='row'>"+
                "<input id='inputMatricule' readonly type='text' half placeholder='Matricule'readonly autocomplete='no' value='"+matricule+"'>"+
                "<input id='inputCours' type='text' half  placeholder='Code du cours' autocomplete='no'>"+
                "<p id='btnAjouter' class='horizontal' style='max-width:300px;max-height:50px;'><span class='text'>Ajouter</span></p>"+
                "</div>"+
                "</div>"
            );

            $("#btnAjouter").click(function(){
                var matricule = $("#inputMatricule").val();
                var cours = $("#inputCours").val();

                $.ajax({
                url: "../PHP/AddCoursEnseigner.php",
                type: "POST",
                dataType: "json",
                data: {
                    "matricule": matricule,
                    "cours": cours
                },
                success: function(result){
                    alert("Le cours à bien été ajouté");
                   location.reload();
                },
                error: function (message, er) {
                    console.log("erreur lors du chargement du profil des etudiants:" + er);
                }
            });

            });
        }

    </script>
</html>