<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="../CSS/Inscription.css"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.2.0/anime.min.js"></script>
        <meta charset="utf-8" />
        <meta name="author" content="Alexandra Sirois, William-Arthur Cinq-Mars, Mathieu Harvey">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Inscription</title>
    </head>

<body onload="alreadyLogged()">

    <div id="MenuBar"></div>
    <div class="page">
        <div class="containerLogin">
          <div class="left">
            <div class="login">Inscription</div>
          </div>
          <div class="right">
            <svg viewBox="0 0 320 300">
              <defs>
                <lineargradient
                                inkscape:collect="always"
                                id="linearGradient"
                                x1="13"
                                y1="193.49992"
                                x2="307"
                                y2="193.49992"
                                gradientUnits="userSpaceOnUse">
                  <stop
                        style="stop-color:#30c5e7;"
                        offset="0"
                        id="stop876" />
                  <stop
                        style="stop-color:#30e79d;"
                        offset="1"
                        id="stop878" />
                </lineargradient>
              </defs>
              <path d="m 40,120.00016 239.99984,-3.2e-4 c 0,0 24.99263,0.79932 25.00016,35.00016 0.008,34.20084 -25.00016,35 -25.00016,35 h -239.99984 c 0,-0.0205 -25,4.01348 -25,38.5 0,34.48652 25,38.5 25,38.5 h 215 c 0,0 20,-0.99604 20,-25 0,-24.00396 -20,-25 -20,-25 h -190 c 0,0 -20,1.71033 -20,25 0,24.00396 20,25 20,25 h 168.57143" />
            </svg>
            <div class="form">
              <label for="matricule">Matricule</label>
              <input type="text" id="matricule" onchange="change()"> <div id="errMat"></div>
              <label for="password">Mot de passe</label>
              <input type="password" id="password" onchange="change()">
              <label for="password2">Confirmez le mot de passe</label>
              <input type="password" id="password2" onchange="change()"><div id="errPas"></div>
              <input type="submit" id="submit" value="Submit" disabled=true onclick="Signup()">
            </div>
          </div>
        </div>
      </div>
      
</body>

    <script type="text/javascript">
        jQuery('#MenuBar').load('Menu.html#Menu'); 
        var current = null;
        document.querySelector("#matricule").addEventListener("focus", function (e) {
        if (current) current.pause();
        current = anime({
            targets: "path",
            strokeDashoffset: {
            value: 0,
            duration: 700,
            easing: "easeOutQuart"
            },
            strokeDasharray: {
            value: "240 1386",
            duration: 700,
            easing: "easeOutQuart"
            }
        });
        });
        document.querySelector("#password").addEventListener("focus", function (e) {
        if (current) current.pause();
        current = anime({
            targets: "path",
            strokeDashoffset: {
            value: -336,
            duration: 700,
            easing: "easeOutQuart"
            },
            strokeDasharray: {
            value: "240 1386",
            duration: 700,
            easing: "easeOutQuart"
            }
        });
        });
        document.querySelector("#submit").addEventListener("focus", function (e) {
        if (current) current.pause();
        current = anime({
            targets: "path",
            strokeDashoffset: {
            value: -730,
            duration: 700,
            easing: "easeOutQuart"
            },
            strokeDasharray: {
            value: "530 1386",
            duration: 700,
            easing: "easeOutQuart"
            }
        });
        });


        function Signup(){
            var username  = $("#matricule").val();
            var password  = $("#password").val();
            var confirm  = $("#password2").val();
            if(password==confirm){
               $.ajax({
                    url: "../PHP/Signup.php",
                    type: "POST",
                    data: {
                        "matricule": username,
                        "password":password
                    },
                    dataType: "json",
                    success: function(result){
                        if(result=username){
                            location.replace("UserProfile.html");
                        }
                        else{
                            alert("Informations entrer invalide");
                        }
                        location.reload();
                    },
                    error: function (message, er) {
                        console.log("erreur lors de la connexion: " + er);
                        location.reload();
                    }
                });}
        }

        function change(){
            var regMat = new RegExp(/[0-9]{7}$/)
            document.getElementById("submit").disabled=true;
                if(regMat.test(document.getElementById("matricule").value)){
                    document.getElementById("errPas").innerHTML="";
                    if($("#password").val()==$("#password2").val()&&$("#password").val().length>0){
                        document.getElementById("errPas").innerHTML="";
                        document.getElementById("submit").style.color="white";
                        document.getElementById("submit").disabled=false;
                    }
                    else{document.getElementById("submit").style.color="grey";
                    document.getElementById("submit").disabled=true;
                    document.getElementById("errPas").innerHTML="";
                        if($("#password").val().length!=0&&$("#password2").val().length!=0){
                            document.getElementById("errPas").append("Les mots de passe ne correspondent pas");}
                        }
                }
                else{document.getElementById("submit").style.color="grey";
                    document.getElementById("submit").disabled=true;
                    document.getElementById("errPas").innerHTML="";
                    document.getElementById("errPas").append("Veuillez entrer un vrai matricule");}
        }

        function alreadyLogged(){
            if(!(document.cookie.indexOf('isLogged')==-1)){
                location.replace("UserProfile.html");
            }
        }

    </script>
</html>